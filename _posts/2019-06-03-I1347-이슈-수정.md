---
title: I1347 이슈 수정
categories: 
author_staff_member: 1minjae
date: 2019-06-03
---

이 포스팅은 이 [commit](https://github.com/19-1-skku-oss/2019-1-OSS-L3/pull/13)을 설명하기 위해서 작성된 글이다.

## 문제  
이 [이슈](https://github.com/gunthercox/ChatterBot/issues/1347)를 해결하는 과정이다. ChatterBot은 문자열 내에서 시간을 파싱하는 함수를 가지고 있다. 그러나 실제 의도한 대로 시간이 파싱되고 있지 않았다. 예를 들어 `today 9pm`을 파싱하면 9시가 아닌 현재 시각에서 9시를 더한 시각이 반환되었다.

## 분석
먼저 이 [코드](https://github.com/gunthercox/ChatterBot/blob/c429fa50c5edf9198030880b9d9151de73a6dced/chatterbot/parsing.py#L648) 에서 `today()` 현재 시각을 포함하는 `datetime` 클래스를 반환하고 있었는데, 이는 현재 날짜 뿐만 아니라 현재 시각을 같이 반환하고 있었다. 이렇게 되면 서브쿼리에서 이 시각과 9시를 더하게 되어 현재 시각에서 9시를 더한 시각이 나왔던 것이다.

두번째로, 이 [코드](https://github.com/gunthercox/ChatterBot/blob/c429fa50c5edf9198030880b9d9151de73a6dced/chatterbot/parsing.py#L31)에서는 만약 문자열이 `(\sam|pm)?`에 매칭되면 `am` 이나 `pm` 문자열이 `convention` 그룹에 대입되지 않았고, 따라서 `pm`이 문자열에 있더라도 결과값에 반영되고 있지 않았다.


## 해결
첫번째 코드의 문제는 반환받은 `datetime` 클래스에서 시각을 전부 0으로 초기화시켜 해결하였다. 두번째 코드의 문제는 정규표현식을 수정하여 해결했다.

그 결과로, 이 코드를 수행하면
```python
from chatterbot import parsing

print(parsing.datetime_parsing(u"Your dental appointment with Dr P. Delvour is scheduled today at 9:00pm."))
print(parsing.datetime_parsing(u"meeting today at 9pm."))
print(parsing.datetime_parsing(u"Your dental appointment with Dr P. Delvour is scheduled for October 29, 16:00. ABC Dentist, 555-555-555."))
print(parsing.datetime_parsing(u"Your dental appointment with Dr P. Delvour is scheduled for October 29, 4 pm. ABC Dentist, 555-555-555."))
print(parsing.datetime_parsing(u"Your dental appointment with Dr P. Delvour is scheduled for October 29, 4:00pm. ABC Dentist, 555-555-555."))
```
올바른 답이 파싱되어 나온다.
```
[('today at 9:00pm', datetime.datetime(2019, 6, 2, 21, 0), (56, 71))]
[('today at 9pm', datetime.datetime(2019, 6, 2, 21, 0), (8, 20))]
[('October 29, 16:00', datetime.datetime(2019, 10, 29, 16, 0), (60, 77))]
[('October 29, 4 pm', datetime.datetime(2019, 10, 29, 16, 0), (60, 76))]
[('October 29, 4:00pm', datetime.datetime(2019, 10, 29, 16, 0), (60, 78))]
```

