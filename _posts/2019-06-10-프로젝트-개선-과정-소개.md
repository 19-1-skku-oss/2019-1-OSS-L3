---
title: 프로젝트 개선 과정 소개
categories: 
author_staff_member: 1minjae
date: 2019-06-10
---

## 프로젝트 개선 과정
원 프로젝트의 이슈 목록을 보다 보면 사용자들이 프로젝트에 대해 개선 요청을 하곤 합니다. 이러한 이슈 중 관심이 가고, 난이도가 낮은 것들을 골라 코드를 작성하여 프로젝트에 기능을 추가해 나갔습니다. 이 문서에서는 그 과정에 대해 설명하도록 하겠습니다.

## [1. export_data 함수에서 중복 데이터 제거](https://github.com/19-1-skku-oss/2019-1-OSS-L3/pull/9)

### 시작
원본 repository에 대해 이슈를 탐색하던 중 [이러한 이슈](https://github.com/gunthercox/ChatterBot/pull/1739)를 확인하게 되었습니다. 요약하자면, `_generate_export_data` 함수에서 중복된 데이터가 생긴다는 것이었습니다. 쉬운 내용으로 보여 한번 도전해 보았습니다.

### 해결 방안 찾기
ChatterBot은 학습된 데이터를 sqlite3 또는 mongodb에 저장하는데, 단순히 사용자의 실수로 중복된 데이터가 두 번 학습될 경우 데이터베이스에 두 번 저장되던 것이었습니다. 따라서 중복 학습을 막으면 해결될 일이었습니다. 그러나 전체 코드의 작동 방식을 완벽히 모르는 상태에서 학습 과정을 수정하는 것은 어떤 부작용을 가져올지 모르는 일이었습니다. 따라서 `_generate_export_data` 함수만 수정하기로 하였습니다. 중복 제거에는 다양한 방식이 있습니다. 처음에는 `if data not in list:`
등의 코드를 사용하였지만 추출 데이터가 클 경우 속도에 문제가 있을 것 같아 `set()` 자료구조를 사용하여 제거하기로 하였습니다.

### 문제점 발생
그러나 ChatterBot의 테스트 케이스를 통과하지 못했습니다. 로그를 확인해 보니 `set()` 자료구조는 수정될 수 있는 데이터를 허용하지 않기에 `tuple` 형태로 넣었지만, 원래는 `list` 형태였기에 테스트 케이스를 통과하지 못한 것입니다.

### 해결
`list(map(list, result))` 코드를 통해 결과값의 `tuple`들을 모두 `list`로 변경해 줌으로써 테스트 케이스를 통과하였습니다.


## [2. 텔레그램과 챗봇 형태로 연동](https://github.com/19-1-skku-oss/2019-1-OSS-L3/pull/48)

### 시작
처음은 [이 이슈](https://github.com/gunthercox/ChatterBot/issues/1747)를 보고 시작하게 되었습니다. 텔레그램 봇의 경우 봇을 만드는 난이도가 상당히 낮은 축에 속하고, `python-telegram-bot`이라는 파이썬 전용 라이브러리도 존재하기 때문에 개발하기 쉬울 것이라고 생각하게 되었습니다. 이미 `chatterbot`은 `django`와의 연동을 위해 `chatterbot/ext` 폴더에 관련 라이브러리들이 존재하고 있어서, 해당 위치에 코드를 작성하였습니다.

### 코드 구조 소개
#### 봇 등록
먼저 Bot을 Telegram의 BotFather 봇을 통해 추가해야 합니다. `/newbot` 명령어를 이용하면 바로 생성할 수 있습니다. 여기서 BotFather 봇이 생성된 봇의 TOKEN을 만들어 주니 잘 보관해야 합니다.

#### `conf.py`
TOKEN과 봇의 이름이 저장되는 곳입니다. 직접 사용자가 지정할 수도 있지만, 그렇지 않을 경우 이 파일에 저장된 기본값을 사용하게 됩니다.

#### `class TelegramBot`
텔레그램 봇의 본체입니다. 토큰과 봇의 이름, 봇 데몬, 명령어 리스트들로 초기화되는 클래스입니다. 초기화 이후 `start()` 메소드를 이용하여 봇을 작동시킬수 있습니다.

#### `class ChatBot`
ChatterBot을 Telegram Bot 형태에 맞게 초기화 시킨 것입니다. 로직 등을 이 단계에서 직접 설정할 수 있습니다.

#### `class BotHandler`
텔레그램 봇의 명령어를 직접 설정할 수 있습니다. 함수를 선언하고 `handler_list`에 추가하면 됩니다. 물론 클래스 외부에서 선언하여 함수만 추가시키는 것도 가능합니다.

#### `apps.py`
TelegramBot과 ChatBot을 초기화시키고 실행시키는 파일입니다.


#### 봇 작동
`apps.py`를 통해 봇을 실행시키면, 다음과 같이 chatterbot에 의한 답변이 오는 것을 볼 수 있습니다.

